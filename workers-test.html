<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">
        <script src='../dist/index_bundle.js'></script>
		<title>Javascript Service Workers</title>
        
    </head>

    <body>
        <button  id='testPush'>Test Push</button>
        <button  id='testNotification'>Test Notification</button>
        <button  id='testAB'>Test AB Test</button>
        <button  id='testCache'>Test Cache</button>
        <button  id='doIt'>DoIT</button>
        <input type="number" id='notification-payload' value='2'>
        <input type="number" id='notification-delay' value='2'>
        <input type="number" id='notification-ttl' value='2'>
       <!-- <img src="/src/images/control.png"/> -->
		<script>

            function addWebAppScript(path){
                let fileref = document.createElement('script');
                fileref.setAttribute("type", "text/javascript");
                fileref.setAttribute("src", path);
                document.getElementsByTagName("head")[0].appendChild(fileref);
            }
            //make sure that Service Workers are supported.
			if(window.navigator && navigator.serviceWorker) {
				navigator.serviceWorker.getRegistrations()
				.then(function(registrations) {
                    
                    for(let registration of registrations) {
                        console.log('unreg')
						// registration.unregister();
					
					}
				});
				}
            if (navigator.serviceWorker) {
                document.getElementById('testPush').onclick = async function () {
                    Notification.requestPermission(function (status) {
                        console.log('Notification permission status:', status);
                    });
                    // addWebAppScript('workers-test/wa-push.js')
                    navigator.serviceWorker.register('server.js', {scope: '/'}) //'workers-test/sw-push/'})
                    .then(function (registration) {
                        console.log(registration);
                    })
                    .catch( function (e) {
                        console.error(e);
                    })
                    try {
                        let { WAPush } =  await import('/wa-push.js')
                        WAPush()
                    } catch (e) {
                        console.error(e)
                    }
                }
                document.getElementById('testAB').onclick = function () {
                   navigator.serviceWorker.register('sw-abtest.js', {scope: '/sw-abtest/'})
                    .then(function (registration) {
                        console.log(registration);
                    })
                    .catch( function (e) {
                        console.error(e);
                    })
                }
                document.getElementById('testNotification').onclick = function () {
                       if (Notification.permission == 'granted') {
                        navigator.serviceWorker.getRegistration().then(function (reg) {

                            var options = {
                                body: 'First notification!',
                                icon: 'https://victoriabernard.com/src/2016/04/Victoria_logo_gear.png',
                                vibrate: [100, 50, 100],
                                data: {
                                    dateOfArrival: Date.now(),
                                    primaryKey: 1
                                },

                                // TODO 2.5 - add actions to the notification

                                // TODO 5.1 - add a tag to the notification

                            };

                            reg.showNotification('Hello world!', options);
                        });
                    }
                }
                document.getElementById('testCache').onclick = function () {
                navigator.serviceWorker.register('sw-cache.js', {scope: '/sw-cache/'})
                    .then(function (registration) {
                        console.log(registration);
                    })
                    .catch( function (e) {
                        console.error(e);
                    })
                }
            } else {
                console.log('Service Worker is not supported in this browser.');
            }




            console.log("My Cookie is", document.cookie)
		</script>
    </body>
</html>
